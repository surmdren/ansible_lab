---
# tasks file for centos_update
- name: Check the repolist
  shell: yum repolist
  become: yes
  register: output_yum

- name: Gather the package facts
  package_facts:
    manager: auto

- name: Check the package update list
  yum: 
    list: updates
    disablerepo: "*"
    enablerepo: base
  become: yes
  register: output_udpate_packages

- name: Create the yum_record file
  shell: cat /dev/null > /tmp/yum_record.txt
    
- name: Print repolist
  blockinfile:
    marker: "## added by ansible"
    content: "{{ item }}"
    path: /tmp/yum_record.txt
  with_items: 
    - "{{ output_yum.stdout }}"
    - "{{ ansible_facts.packages }}"
    - "{{ output_udpate_packages }}"

- name: Create localhost directory to store the record file
  file:
    path: ~/yum_record/
    state: directory
  delegate_to: localhost

- name: Fetch the yum_record file
  fetch: 
    src: /tmp/yum_record.txt
    dest: ~/yum_record/yum_record_{{ ansible_date_time.date }}

